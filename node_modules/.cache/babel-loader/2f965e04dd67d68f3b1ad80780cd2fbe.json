{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\n\nvar _getContext = _interopRequireDefault(require(\"./getContext\"));\n\nvar _loseGL = _interopRequireDefault(require(\"./loseGL\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n          if (desc.get || desc.set) {\n            Object.defineProperty(newObj, key, desc);\n          } else {\n            newObj[key] = obj[key];\n          }\n        }\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nconst __DEV__ = process.env.NODE_ENV === \"development\";\n/**\n * WebGL context initial options.\n */\n\n\nconst propTypes = {\n  onContextCreate: _propTypes.default.func.isRequired,\n  onContextFailure: _propTypes.default.func.isRequired,\n  onContextLost: _propTypes.default.func.isRequired,\n  onContextRestored: _propTypes.default.func.isRequired,\n  webglContextAttributes: _propTypes.default.object,\n  width: _propTypes.default.number.isRequired,\n  height: _propTypes.default.number.isRequired,\n  style: _propTypes.default.object,\n  pixelRatio: _propTypes.default.number\n};\n\nclass ErrorDebug extends _react.Component {\n  render() {\n    const error = this.props.error;\n    let title = String(error.rawError || error.message || error);\n    let detail = String(error.longMessage || error.rawError || \"\");\n    const style = {\n      width: \"100%\",\n      height: \"100%\",\n      position: \"absolute\",\n      top: 0,\n      left: 0,\n      padding: \"1em\",\n      background: \"#a00\",\n      color: \"#fff\",\n      fontSize: \"12px\",\n      lineHeight: \"1.2em\",\n      fontStyle: \"normal\",\n      fontWeight: \"normal\",\n      fontFamily: \"monospace\",\n      overflow: \"auto\"\n    };\n    const titleStyle = {\n      fontWeight: \"bold\",\n      marginBottom: \"1em\"\n    };\n    const detailStyle = {\n      whiteSpace: \"pre\"\n    };\n    return _react.default.createElement(\"div\", {\n      style: style\n    }, _react.default.createElement(\"div\", {\n      style: titleStyle\n    }, title), _react.default.createElement(\"div\", {\n      style: detailStyle\n    }, detail));\n  }\n\n}\n\nclass GLViewDOM extends _react.Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      error: null\n    });\n\n    _defineProperty(this, \"webglContextAttributes\", void 0);\n\n    _defineProperty(this, \"canvas\", void 0);\n\n    _defineProperty(this, \"gl\", void 0);\n\n    _defineProperty(this, \"_onContextLost\", e => {\n      e.preventDefault();\n      this.gl = null;\n      this.props.onContextLost();\n    });\n\n    _defineProperty(this, \"_onContextRestored\", () => {\n      this.gl = this._createContext();\n      this.props.onContextRestored(this.gl);\n    });\n\n    _defineProperty(this, \"onRef\", ref => {\n      this.canvas = ref;\n    });\n\n    _defineProperty(this, \"debugError\", !__DEV__ ? null : error => {\n      this.setState({\n        error\n      });\n    });\n\n    _defineProperty(this, \"afterDraw\", !__DEV__ ? null : () => {\n      if (this.state.error) {\n        this.setState({\n          error: null\n        });\n      }\n    });\n  }\n\n  componentDidMount() {\n    const _this$props2 = this.props,\n          onContextCreate = _this$props2.onContextCreate,\n          onContextFailure = _this$props2.onContextFailure;\n\n    const gl = this._createContext();\n\n    if (gl) {\n      this.gl = gl;\n      onContextCreate(gl);\n      const canvas = this.canvas;\n      (0, _invariant.default)(canvas, \"canvas is not settled in GLViewDOM#componentDidMount\");\n      canvas.addEventListener(\"webglcontextlost\", this._onContextLost);\n      canvas.addEventListener(\"webglcontextrestored\", this._onContextRestored);\n    } else {\n      onContextFailure(new Error(\"no-webgl-context\"));\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.gl) {\n      (0, _loseGL.default)(this.gl);\n      this.gl = null;\n    }\n\n    const canvas = this.canvas;\n\n    if (canvas) {\n      canvas.removeEventListener(\"webglcontextlost\", this._onContextLost);\n      canvas.removeEventListener(\"webglcontextrestored\", this._onContextRestored);\n    }\n  }\n\n  render() {\n    const error = this.state.error;\n\n    let _this$props = this.props,\n        width = _this$props.width,\n        height = _this$props.height,\n        pixelRatio = _this$props.pixelRatio,\n        style = _this$props.style,\n        debug = _this$props.debug,\n        rest = _objectWithoutProperties(_this$props, [\"width\", \"height\", \"pixelRatio\", \"style\", \"debug\"]);\n\n    if (!pixelRatio) pixelRatio = Number(typeof window === \"object\" && window.devicePixelRatio || 1);\n\n    for (let k in propTypes) {\n      if (rest.hasOwnProperty(k)) {\n        delete rest[k];\n      }\n    }\n\n    return _react.default.createElement(\"span\", {\n      style: _objectSpread({}, style, {\n        display: \"inline-block\",\n        position: \"relative\",\n        width,\n        height\n      })\n    }, _react.default.createElement(\"canvas\", _extends({\n      ref: this.onRef,\n      style: {\n        width,\n        height\n      },\n      width: width * pixelRatio,\n      height: height * pixelRatio\n    }, rest)), error ? _react.default.createElement(ErrorDebug, {\n      error: error\n    }) : null);\n  }\n\n  _createContext() {\n    const _this$props3 = this.props,\n          webglContextAttributes = _this$props3.webglContextAttributes,\n          debug = _this$props3.debug;\n    const gl = (0, _getContext.default)(this.canvas, debug ? _objectSpread({}, webglContextAttributes, {\n      preserveDrawingBuffer: true\n    }) : webglContextAttributes);\n    this.webglContextAttributes = webglContextAttributes || {};\n    return gl;\n  }\n\n  captureAsDataURL(...args) {\n    if (!this.webglContextAttributes.preserveDrawingBuffer) {\n      console.warn(\"Surface#captureAsDataURL is likely to not work if you don't define webglContextAttributes={{ preserveDrawingBuffer: true }}\");\n    }\n\n    (0, _invariant.default)(this.canvas, \"canvas is no longer available\");\n    return this.canvas.toDataURL(...args);\n  }\n\n  captureAsBlob(...args) {\n    if (!this.webglContextAttributes.preserveDrawingBuffer) {\n      console.warn(\"Surface#captureAsBlob is likely to not work if you don't define webglContextAttributes={{ preserveDrawingBuffer: true }}\");\n    }\n\n    return Promise.resolve().then(() => new Promise((resolve, reject) => this.canvas ? this.canvas.toBlob(resolve, ...args) : reject(new Error(\"canvas is no longer available\"))));\n  }\n\n}\n\nexports.default = GLViewDOM;\n\n_defineProperty(GLViewDOM, \"propTypes\", propTypes);","map":{"version":3,"sources":["../src/GLViewDOM.js"],"names":["__DEV__","process","propTypes","onContextCreate","PropTypes","onContextFailure","onContextLost","onContextRestored","webglContextAttributes","width","height","style","pixelRatio","number","Component","render","error","title","String","detail","position","top","left","padding","background","color","fontSize","lineHeight","fontStyle","fontWeight","fontFamily","overflow","titleStyle","marginBottom","detailStyle","whiteSpace","GLViewDOM","componentDidMount","gl","canvas","componentWillUnmount","debug","Number","window","rest","display","_createContext","preserveDrawingBuffer","e","ref","captureAsDataURL","console","captureAsBlob","Promise","reject"],"mappings":"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","sourcesContent":["//@flow\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport invariant from \"invariant\";\nimport getContext from \"./getContext\";\nimport loseGL from \"./loseGL\";\n\nconst __DEV__ = process.env.NODE_ENV === \"development\";\n\n/**\n * WebGL context initial options.\n */\ntype WebGLContextAttributes = {\n  alpha?: boolean,\n  depth?: boolean,\n  stencil?: boolean,\n  antialias?: boolean,\n  premultipliedAlpha?: boolean,\n  preserveDrawingBuffer?: boolean,\n  preferLowPowerToHighPerformance?: boolean,\n  failIfMajorPerformanceCaveat?: boolean\n};\n\nconst propTypes = {\n  onContextCreate: PropTypes.func.isRequired,\n  onContextFailure: PropTypes.func.isRequired,\n  onContextLost: PropTypes.func.isRequired,\n  onContextRestored: PropTypes.func.isRequired,\n  webglContextAttributes: PropTypes.object,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired,\n  style: PropTypes.object,\n  pixelRatio: PropTypes.number\n};\n\nclass ErrorDebug extends Component {\n  render() {\n    const { error } = this.props;\n    let title = String(error.rawError || error.message || error);\n    let detail = String(error.longMessage || error.rawError || \"\");\n    const style = {\n      width: \"100%\",\n      height: \"100%\",\n      position: \"absolute\",\n      top: 0,\n      left: 0,\n      padding: \"1em\",\n      background: \"#a00\",\n      color: \"#fff\",\n      fontSize: \"12px\",\n      lineHeight: \"1.2em\",\n      fontStyle: \"normal\",\n      fontWeight: \"normal\",\n      fontFamily: \"monospace\",\n      overflow: \"auto\"\n    };\n    const titleStyle = {\n      fontWeight: \"bold\",\n      marginBottom: \"1em\"\n    };\n    const detailStyle = {\n      whiteSpace: \"pre\"\n    };\n    return (\n      <div style={style}>\n        <div style={titleStyle}>{title}</div>\n        <div style={detailStyle}>{detail}</div>\n      </div>\n    );\n  }\n}\n\nexport default class GLViewDOM extends Component<\n  {\n    onContextCreate: (gl: WebGLRenderingContext) => void,\n    onContextFailure: (e: Error) => void,\n    onContextLost: () => void,\n    onContextRestored: (gl: ?WebGLRenderingContext) => void,\n    webglContextAttributes?: WebGLContextAttributes,\n    pixelRatio?: number,\n    width: number,\n    height: number,\n    style?: any,\n    debug?: number\n  },\n  {\n    error: ?Error\n  }\n> {\n  state = {\n    error: null\n  };\n  static propTypes = propTypes;\n  webglContextAttributes: WebGLContextAttributes;\n  canvas: ?HTMLCanvasElement;\n  gl: ?WebGLRenderingContext;\n\n  componentDidMount() {\n    const { onContextCreate, onContextFailure } = this.props;\n    const gl: ?WebGLRenderingContext = this._createContext();\n    if (gl) {\n      this.gl = gl;\n      onContextCreate(gl);\n      const { canvas } = this;\n      invariant(canvas, \"canvas is not settled in GLViewDOM#componentDidMount\");\n      canvas.addEventListener(\"webglcontextlost\", this._onContextLost);\n      canvas.addEventListener(\"webglcontextrestored\", this._onContextRestored);\n    } else {\n      onContextFailure(new Error(\"no-webgl-context\"));\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.gl) {\n      loseGL(this.gl);\n      this.gl = null;\n    }\n    const { canvas } = this;\n    if (canvas) {\n      canvas.removeEventListener(\"webglcontextlost\", this._onContextLost);\n      canvas.removeEventListener(\n        \"webglcontextrestored\",\n        this._onContextRestored\n      );\n    }\n  }\n\n  render() {\n    const { error } = this.state;\n    let { width, height, pixelRatio, style, debug, ...rest } = this.props;\n    if (!pixelRatio)\n      pixelRatio = Number(\n        (typeof window === \"object\" && window.devicePixelRatio) || 1\n      );\n    for (let k in propTypes) {\n      if (rest.hasOwnProperty(k)) {\n        delete rest[k];\n      }\n    }\n    return (\n      <span\n        style={{\n          ...style,\n          display: \"inline-block\",\n          position: \"relative\",\n          width,\n          height\n        }}\n      >\n        <canvas\n          ref={this.onRef}\n          style={{ width, height }}\n          width={width * pixelRatio}\n          height={height * pixelRatio}\n          {...rest}\n        />\n        {error ? <ErrorDebug error={error} /> : null}\n      </span>\n    );\n  }\n\n  _createContext() {\n    const { webglContextAttributes, debug } = this.props;\n    const gl: ?WebGLRenderingContext = getContext(\n      this.canvas,\n      debug\n        ? { ...webglContextAttributes, preserveDrawingBuffer: true }\n        : webglContextAttributes\n    );\n    this.webglContextAttributes = webglContextAttributes || {};\n    return gl;\n  }\n\n  _onContextLost = (e: Event) => {\n    e.preventDefault();\n    this.gl = null;\n    this.props.onContextLost();\n  };\n\n  _onContextRestored = () => {\n    this.gl = this._createContext();\n    this.props.onContextRestored(this.gl);\n  };\n\n  onRef = (ref: HTMLCanvasElement) => {\n    this.canvas = ref;\n  };\n\n  debugError = !__DEV__\n    ? null\n    : (error: Error) => {\n        this.setState({ error });\n      };\n\n  afterDraw = !__DEV__\n    ? null\n    : () => {\n        if (this.state.error) {\n          this.setState({ error: null });\n        }\n      };\n\n  captureAsDataURL(...args: any): string {\n    if (!this.webglContextAttributes.preserveDrawingBuffer) {\n      console.warn(\n        \"Surface#captureAsDataURL is likely to not work if you don't define webglContextAttributes={{ preserveDrawingBuffer: true }}\"\n      );\n    }\n    invariant(this.canvas, \"canvas is no longer available\");\n    return this.canvas.toDataURL(...args);\n  }\n\n  captureAsBlob(...args: any): Promise<Blob> {\n    if (!this.webglContextAttributes.preserveDrawingBuffer) {\n      console.warn(\n        \"Surface#captureAsBlob is likely to not work if you don't define webglContextAttributes={{ preserveDrawingBuffer: true }}\"\n      );\n    }\n    return Promise.resolve().then(\n      () =>\n        new Promise((resolve, reject) =>\n          this.canvas\n            ? this.canvas.toBlob(resolve, ...args)\n            : reject(new Error(\"canvas is no longer available\"))\n        )\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"script"}